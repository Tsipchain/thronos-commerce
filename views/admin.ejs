<!DOCTYPE html>
<html lang="<%= lang %>">
  <head>
    <meta charset="UTF-8" />
    <title><%= t('admin.tabTheme').split('&')[0].trim() %> â€“ <%= config.storeName %></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/styles.css" />
    <style>
      :root {
        --primary-color: <%= config.primaryColor %>;
        --accent-color: <%= config.accentColor %>;
        --font-family: <%= config.fontFamily %>;
        --menu-bg: <%= (config.theme && config.theme.menuBg) || '#111' %>;
        --menu-text: <%= (config.theme && config.theme.menuText) || '#fff' %>;
        --menu-active-bg: <%= (config.theme && config.theme.menuActiveBg) || '#f06292' %>;
        --menu-active-text: <%= (config.theme && config.theme.menuActiveText) || '#fff' %>;
        --button-radius: <%= (config.theme && config.theme.buttonRadius) || '4px' %>;
      }

      /* â”€â”€ Full-Ops banner â”€â”€ */
      .fullops-banner {
        background: #fff3cd;
        border: 1px solid #ffc107;
        border-radius: 6px;
        padding: 14px 18px;
        margin-bottom: 20px;
        font-size: 0.95rem;
        line-height: 1.5;
        color: #5a4200;
      }

      /* â”€â”€ Products table & modal â”€â”€ */
      .products-table { width: 100%; border-collapse: collapse; margin-bottom: 12px; }
      .products-table th, .products-table td {
        text-align: left; padding: 8px 10px;
        border-bottom: 1px solid #e0e0e0; font-size: 0.88rem;
      }
      .products-table th { background: #f5f5f5; font-weight: 600; }
      .products-table .thumb { width: 48px; height: 48px; object-fit: cover; border-radius: 4px; }
      .products-table .no-img { width: 48px; height: 48px; background: #eee; border-radius: 4px; display: inline-block; }
      .btn-sm { padding: 4px 10px; font-size: 0.8rem; border-radius: 4px; cursor: pointer;
                border: 1px solid #ccc; background: #fff; }
      .btn-sm.edit { border-color: var(--accent-color); color: var(--accent-color); }
      .btn-sm.del  { border-color: #e57373; color: #e57373; }
      .btn-sm:disabled { opacity: 0.4; cursor: not-allowed; }

      /* modal overlay */
      .modal-overlay {
        display: none; position: fixed; inset: 0;
        background: rgba(0,0,0,.45); z-index: 900;
        align-items: center; justify-content: center;
      }
      .modal-overlay.open { display: flex; }
      .modal-box {
        background: #fff; border-radius: 8px; padding: 28px 28px 20px;
        width: min(520px, 95vw); max-height: 90vh; overflow-y: auto;
        box-shadow: 0 8px 32px rgba(0,0,0,.18);
      }
      .modal-box h3 { margin-top: 0; }
      .modal-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
      .modal-grid .full { grid-column: 1 / -1; }
      .modal-grid label { display: flex; flex-direction: column; gap: 4px; font-size: 0.86rem; }
      .modal-grid input, .modal-grid textarea, .modal-grid select {
        padding: 6px 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 0.9rem;
      }
      .modal-actions { display: flex; gap: 10px; margin-top: 16px; justify-content: flex-end; }

      /* helper text */
      .helper { font-size: 0.82rem; color: #666; margin: 0 0 12px; }

      /* password row for product save */
      .save-row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-top: 10px; }
      .save-row input[type=password] { flex: 1 1 180px; }

      /* â”€â”€ Shipping & Payment table â”€â”€ */
      .sp-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
      .sp-table th, .sp-table td {
        padding: 8px 10px; text-align: left;
        border-bottom: 1px solid #e0e0e0; font-size: 0.87rem;
      }
      .sp-table th { background: #f5f5f5; font-weight: 600; white-space: nowrap; }
      .sp-table input[type=text],
      .sp-table input[type=number] {
        width: 100%; box-sizing: border-box;
        padding: 5px 7px; border: 1px solid #ccc; border-radius: 4px; font-size: 0.87rem;
      }
      .sp-table input:read-only { background: #f9f9f9; color: #888; cursor: not-allowed; }
      .sp-badge {
        display: inline-block; background: #e8f4fd; color: #1a73b8;
        border-radius: 3px; padding: 1px 6px; font-size: 0.76rem; font-family: monospace;
      }

      /* â”€â”€ Color picker pairs â”€â”€ */
      .color-field { display: flex; gap: 6px; align-items: center; }
      .color-field input[type=text]  { flex: 1; }
      .color-field input[type=color] {
        width: 36px; height: 34px; padding: 2px;
        border: 1px solid #ccc; border-radius: 4px; cursor: pointer; background: #fff;
        flex-shrink: 0;
      }
      .color-field input[type=color]:disabled { opacity: 0.4; cursor: not-allowed; }

      /* â”€â”€ Logo upload inline â”€â”€ */
      .logo-upload-row { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; margin-top: 4px; }
      .logo-upload-row input[type=file] { flex: 1 1 160px; font-size: 0.82rem; }
      .btn-xs { padding: 5px 12px; font-size: 0.8rem; background: #eee;
                border: 1px solid #ccc; border-radius: 4px; cursor: pointer; white-space: nowrap; }
      #logo-upload-status { font-size: 0.8rem; color: #555; margin-top: 4px; }

      /* â”€â”€ Notifications section â”€â”€ */
      .notif-section { margin-top: 22px; padding-top: 16px; border-top: 1px dashed #ddd; }
      .notif-section h3 { margin: 0 0 4px; }
      .checkbox-label { display: flex !important; flex-direction: row !important;
                        align-items: center; gap: 8px; cursor: pointer; }
      .checkbox-label input[type=checkbox] { width: auto; margin: 0; }
    </style>
  </head>
  <body>
    <header>
      <h1><%= t('admin.headerTitle') %></h1>
      <p class="subtitle">
        <%= t('admin.store') %>: <strong><%= tenant.id %></strong>
        &nbsp;Â·&nbsp;
        <%= t('admin.package') %>: <strong><%= tenant.supportTier %></strong>
        &nbsp;Â·&nbsp;
        <a href="/admin" style="font-size:0.85rem"><%= t('admin.settingsLink') %></a>
        &nbsp;|&nbsp;
        <a href="/admin/orders" style="font-size:0.85rem"><%= t('admin.ordersLink') %></a>
        &nbsp;|&nbsp;
        <a href="/" style="font-size:0.85rem"><%= t('admin.storefrontLink') %></a>
      </p>
    </header>

    <main class="admin-layout">

      <%# â”€â”€ Full-Ops banner â”€â”€ %>
      <% if (tenant.supportTier === 'FULL_OPS_START') { %>
      <div class="fullops-banner">
        <strong><%= t('admin.fullOpsBanner') %></strong><br>
        <%= t('admin.fullOpsText') %>
      </div>
      <% } %>

      <%# â”€â”€ Flash messages â”€â”€ %>
      <% if (message) { %><p class="admin-msg success"><%= message %></p><% } %>
      <% if (error)   { %><p class="admin-msg error"><%= error %></p><% } %>

      <nav class="admin-tabs">
        <a href="#tab-theme"><%= t('admin.tabTheme') %></a>
        <a href="#tab-categories"><%= t('admin.tabCategories') %></a>
        <a href="#tab-products"><%= t('admin.tabProducts') %></a>
        <a href="#tab-upload"><%= t('admin.tabImages') %></a>
        <a href="#tab-shipping"><%= t('admin.tabShipping') %></a>
        <a href="#tab-notifications"><%= t('admin.tabNotifications') %></a>
        <a href="#tab-inventory"><%= t('admin.tabInventory') %></a>
        <a href="/admin/orders"><%= t('admin.tabOrders') %></a>
      </nav>


      <%# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• %>
      <%#   TAB 1 â€“ THEME / SETTINGS                                %>
      <%# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• %>
      <form id="tab-theme" class="admin-block" method="POST" action="/admin/settings">
        <h2><%= t('admin.themeTitle') %></h2>
        <p class="helper"><%= t('admin.themeHelper') %></p>

        <label><span><%= t('admin.storeName') %></span>
          <input type="text" name="storeName" value="<%= config.storeName %>"
                 <%= permissions.canEditSettings ? '' : 'readonly' %> />
        </label>

        <label><span><%= t('admin.primaryColor') %></span>
          <div class="color-field">
            <input type="text" name="primaryColor" id="txt-primaryColor"
                   value="<%= config.primaryColor %>" placeholder="#222222"
                   <%= permissions.canEditSettings ? '' : 'readonly' %> />
            <input type="color" id="cp-primaryColor" value="<%= config.primaryColor || '#222222' %>"
                   title="Î•Ï€Î¹Î»Î¿Î³Î® Ï‡ÏÏÎ¼Î±Ï„Î¿Ï‚" <%= permissions.canEditSettings ? '' : 'disabled' %> />
          </div>
        </label>

        <label><span><%= t('admin.accentColor') %></span>
          <div class="color-field">
            <input type="text" name="accentColor" id="txt-accentColor"
                   value="<%= config.accentColor %>" placeholder="#00ff88"
                   <%= permissions.canEditSettings ? '' : 'readonly' %> />
            <input type="color" id="cp-accentColor" value="<%= config.accentColor || '#00ff88' %>"
                   title="Î•Ï€Î¹Î»Î¿Î³Î® Ï‡ÏÏÎ¼Î±Ï„Î¿Ï‚" <%= permissions.canEditSettings ? '' : 'disabled' %> />
          </div>
        </label>

        <label><span><%= t('admin.fontFamily') %></span>
          <select name="fontFamily" <%= permissions.canEditSettings ? '' : 'disabled' %>>
            <option value="system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif"
              <%= config.fontFamily.includes('system-ui') ? 'selected' : '' %>>System UI (Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î®)</option>
            <option value="'Roboto', Arial, sans-serif"
              <%= config.fontFamily.includes('Roboto') ? 'selected' : '' %>>Roboto</option>
            <option value="'Segoe UI', system-ui, sans-serif"
              <%= config.fontFamily.includes('Segoe UI') && !config.fontFamily.includes('system-ui, -apple') ? 'selected' : '' %>>Segoe UI</option>
          </select>
        </label>

        <label><span><%= t('admin.heroTextLabel') %></span>
          <textarea name="heroText" rows="3"
                    <%= permissions.canEditSettings ? '' : 'readonly' %>><%= config.heroText %></textarea>
        </label>

        <label><span><%= t('admin.web3DomainLabel') %></span>
          <input type="text" name="web3Domain" value="<%= config.web3Domain %>"
                 placeholder="Ï€.Ï‡. mystore.thr" <%= permissions.canEditSettings ? '' : 'readonly' %> />
        </label>

        <label><span><%= t('admin.logoPath') %></span>
          <input type="text" name="logoPath" id="logoPath-input" value="<%= config.logoPath %>"
                 placeholder="/logo.svg" <%= permissions.canEditSettings ? '' : 'readonly' %> />
        </label>
        <% if (permissions.canUploadMedia) { %>
        <div style="margin:-4px 0 14px;">
          <p class="helper" style="margin-bottom:5px;"><%= t('admin.uploadLogoHelper') %></p>
          <div class="logo-upload-row">
            <input type="file" id="logo-file" accept="image/*" />
            <input type="password" id="logo-pass" placeholder="<%= t('admin.logoPassPlaceholder') %>" style="width:130px;" />
            <button type="button" class="btn-xs" id="logo-upload-btn"><%= t('admin.uploadLogoBtn') %></button>
          </div>
          <p id="logo-upload-status"></p>
        </div>
        <% } %>

        <h3><%= t('admin.menuColors') %></h3>
        <p class="helper"><%= t('admin.menuColorsHelper') %></p>

        <label><span><%= t('admin.menuBg') %></span>
          <div class="color-field">
            <input type="text" name="themeMenuBg" id="txt-themeMenuBg"
                   value="<%= (config.theme && config.theme.menuBg) || '#111111' %>"
                   <%= permissions.canEditSettings ? '' : 'readonly' %> />
            <input type="color" id="cp-themeMenuBg"
                   value="<%= (config.theme && config.theme.menuBg) || '#111111' %>"
                   title="Î•Ï€Î¹Î»Î¿Î³Î® Ï‡ÏÏÎ¼Î±Ï„Î¿Ï‚" <%= permissions.canEditSettings ? '' : 'disabled' %> />
          </div>
        </label>

        <label><span><%= t('admin.menuText') %></span>
          <div class="color-field">
            <input type="text" name="themeMenuText" id="txt-themeMenuText"
                   value="<%= (config.theme && config.theme.menuText) || '#ffffff' %>"
                   <%= permissions.canEditSettings ? '' : 'readonly' %> />
            <input type="color" id="cp-themeMenuText"
                   value="<%= (config.theme && config.theme.menuText) || '#ffffff' %>"
                   title="Î•Ï€Î¹Î»Î¿Î³Î® Ï‡ÏÏÎ¼Î±Ï„Î¿Ï‚" <%= permissions.canEditSettings ? '' : 'disabled' %> />
          </div>
        </label>

        <label><span><%= t('admin.menuActiveBg') %></span>
          <div class="color-field">
            <input type="text" name="themeMenuActiveBg" id="txt-themeMenuActiveBg"
                   value="<%= (config.theme && config.theme.menuActiveBg) || '#f06292' %>"
                   <%= permissions.canEditSettings ? '' : 'readonly' %> />
            <input type="color" id="cp-themeMenuActiveBg"
                   value="<%= (config.theme && config.theme.menuActiveBg) || '#f06292' %>"
                   title="Î•Ï€Î¹Î»Î¿Î³Î® Ï‡ÏÏÎ¼Î±Ï„Î¿Ï‚" <%= permissions.canEditSettings ? '' : 'disabled' %> />
          </div>
        </label>

        <label><span><%= t('admin.menuActiveText') %></span>
          <div class="color-field">
            <input type="text" name="themeMenuActiveText" id="txt-themeMenuActiveText"
                   value="<%= (config.theme && config.theme.menuActiveText) || '#ffffff' %>"
                   <%= permissions.canEditSettings ? '' : 'readonly' %> />
            <input type="color" id="cp-themeMenuActiveText"
                   value="<%= (config.theme && config.theme.menuActiveText) || '#ffffff' %>"
                   title="Î•Ï€Î¹Î»Î¿Î³Î® Ï‡ÏÏÎ¼Î±Ï„Î¿Ï‚" <%= permissions.canEditSettings ? '' : 'disabled' %> />
          </div>
        </label>

        <label><span><%= t('admin.buttonRadius') %></span>
          <input type="text" name="themeButtonRadius"
                 value="<%= (config.theme && config.theme.buttonRadius) || '4px' %>"
                 placeholder="4px" <%= permissions.canEditSettings ? '' : 'readonly' %> />
        </label>

        <%# â”€â”€ Î•Î¹Î´Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚ â”€â”€ %>
        <div class="notif-section">
          <h3><%= t('admin.notifEmail') %></h3>
          <p class="helper"><%= t('admin.notifEmailHelper') %></p>

          <label><span><%= t('admin.notifEmailLabel') %> <small style="color:#999">(<%= t('admin.notifEmailHint') %>)</small></span>
            <textarea name="notificationEmails" rows="3"
                      placeholder="owner@myshop.gr&#10;backup@myshop.gr"
                      <%= permissions.canEditSettings ? '' : 'readonly' %>><%= (config.notificationEmails || []).join('\n') %></textarea>
          </label>

          <label class="checkbox-label">
            <input type="checkbox" name="notificationCcCustomer"
                   <%= (config.notificationCcCustomer) ? 'checked' : '' %>
                   <%= permissions.canEditSettings ? '' : 'disabled' %> />
            <span><%= t('admin.notifCcCustomer') %></span>
          </label>

          <label><span><%= t('admin.notifFromName') %></span>
            <input type="text" name="notificationFromName"
                   value="<%= config.notificationFromName || '' %>"
                   placeholder="Ï€.Ï‡. FashionMM Store"
                   <%= permissions.canEditSettings ? '' : 'readonly' %> />
          </label>

          <h3 style="margin-top:18px;"><%= t('admin.notifWebhook') %></h3>
          <p class="helper"><%= t('admin.notifWebhookHelper') %></p>

          <label><span><%= t('admin.webhookUrl') %></span>
            <input type="text" name="notificationWebhookUrl"
                   value="<%= config.notificationWebhookUrl || '' %>"
                   placeholder="https://myhook.example.com/orders"
                   <%= permissions.canEditSettings ? '' : 'readonly' %> />
          </label>

          <label><span><%= t('admin.webhookSecret') %> <small style="color:#999">(<%= t('admin.webhookSecretHint') %>)</small></span>
            <input type="text" name="notificationWebhookSecret"
                   value="<%= config.notificationWebhookSecret || '' %>"
                   placeholder="mysecret123"
                   <%= permissions.canEditSettings ? '' : 'readonly' %> />
          </label>
        </div>

        <%# â”€â”€ Stripe Integration â”€â”€ %>
        <div style="margin-top:24px;padding:18px 20px;background:#f5f3ff;border:1px solid #ddd6fe;border-radius:10px;">
          <p style="margin:0 0 12px;font-weight:700;font-size:.95rem;color:#5b21b6;">ğŸ’³ Stripe â€” Online Ï€Î»Î·ÏÏ‰Î¼Î­Ï‚ Î¼Îµ ÎºÎ¬ÏÏ„Î±</p>
          <p class="helper" style="margin:0 0 14px;color:#6b7280;font-size:.82rem;">
            Î“Î¹Î± Î½Î± ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï€Î»Î·ÏÏ‰Î¼Î­Ï‚ Î¼Îµ ÎºÎ¬ÏÏ„Î±, ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î± ÎºÎ»ÎµÎ¹Î´Î¹Î¬ ÏƒÎ±Ï‚ Î±Ï€ÏŒ Ï„Î¿
            <a href="https://dashboard.stripe.com/apikeys" target="_blank" rel="noopener">Stripe Dashboard</a>.
            ÎœÎµÏ„Î¬ Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Î¼Î­Î¸Î¿Î´Î¿ Ï€Î»Î·ÏÏ‰Î¼Î®Ï‚ Î¼Îµ <code>type: "stripe"</code> Î±Ï€ÏŒ Ï„Î¿Î½ root admin.
          </p>
          <label style="display:flex;flex-direction:column;gap:4px;font-size:.86rem;margin-bottom:10px;">
            <span>Publishable Key <small style="color:#888;">(pk_live_â€¦ Î® pk_test_â€¦)</small></span>
            <input type="text" name="stripePublishableKey"
                   value="<%= config.stripePublishableKey || '' %>"
                   placeholder="pk_live_..."
                   <%= permissions.canEditSettings ? '' : 'readonly' %>
                   style="padding:7px 10px;border:1px solid #c4b5fd;border-radius:4px;font-size:.84rem;font-family:monospace;" />
          </label>
          <label style="display:flex;flex-direction:column;gap:4px;font-size:.86rem;">
            <span>Secret Key <small style="color:#888;">(sk_live_â€¦ Î® sk_test_â€¦)</small></span>
            <input type="password" name="stripeSecretKey"
                   value="<%= config.stripeSecretKey ? 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢' : '' %>"
                   placeholder="sk_live_..."
                   <%= permissions.canEditSettings ? '' : 'readonly' %>
                   autocomplete="new-password"
                   style="padding:7px 10px;border:1px solid #c4b5fd;border-radius:4px;font-size:.84rem;font-family:monospace;" />
            <small style="color:#888;font-size:.76rem;">Î‘Ï†Î®ÏƒÏ„Îµ ÎºÎµÎ½ÏŒ Î±Î½ Î´ÎµÎ½ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î±Î»Î»Î¬Î¾ÎµÏ„Îµ Ï„Î¿ Ï…Ï€Î¬ÏÏ‡Î¿Î½ ÎºÎ»ÎµÎ¹Î´Î¯.</small>
          </label>
          <% if (config.stripeSecretKey) { %>
            <p style="margin:10px 0 0;font-size:.8rem;color:#059669;">âœ“ Stripe ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿</p>
          <% } %>
        </div>

        <label><span><%= t('admin.adminPass') %></span>
          <input type="password" name="password"
                 <%= permissions.canEditSettings ? 'required' : 'disabled' %> />
        </label>

        <button type="submit" class="button" <%= permissions.canEditSettings ? '' : 'disabled' %>>
          <%= t('admin.saveSettings') %>
        </button>
        <% if (!permissions.canEditSettings) { %>
          <p class="helper" style="margin-top:8px;"><%= t('admin.fullOpsManagedNote') %></p>
        <% } %>
      </form>


      <%# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• %>
      <%#   TAB 2 â€“ CATEGORIES                                      %>
      <%# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• %>
      <section id="tab-categories" class="admin-block">
        <h2><%= t('admin.categoriesTitle') %></h2>
        <p class="helper"><%= t('admin.categoriesHelper') %></p>

        <table class="admin-table">
          <thead>
            <tr>
              <th><%= t('admin.catColId') %></th>
              <th><%= t('admin.catColName') %></th>
              <th><%= t('admin.catColSlug') %></th>
              <th><%= t('admin.catColParent') %></th>
              <th><%= t('admin.catColAction') %></th>
            </tr>
          </thead>
          <tbody>
            <% categories.forEach(function(cat){ %>
              <tr>
                <td><code><%= cat.id %></code></td>
                <td><%= cat.name %></td>
                <td><%= cat.slug %></td>
                <td><%= cat.parentId ? cat.parentId : 'â€“' %></td>
                <td>
                  <form method="POST" action="/admin/categories/delete" class="inline-form">
                    <input type="hidden" name="categoryId" value="<%= cat.id %>" />
                    <input type="password" name="password" placeholder="ÎšÏ‰Î´Î¹ÎºÏŒÏ‚"
                           <%= permissions.canEditCategories ? 'required' : 'disabled' %> />
                    <button type="submit" class="button danger"
                            <%= permissions.canEditCategories ? '' : 'disabled' %>><%= t('admin.catDelete') %></button>
                  </form>
                </td>
              </tr>
            <% }) %>
            <% if (categories.length === 0) { %>
              <tr><td colspan="4" style="color:#888;font-style:italic;"><%= t('admin.catNone') %></td></tr>
            <% } %>
          </tbody>
        </table>

        <% if (permissions.canEditCategories) { %>
        <form method="POST" action="/admin/categories/add" class="admin-subform">
          <h3><%= t('admin.catAddTitle') %></h3>
          <p class="helper"><%= t('admin.catAddHelper') %></p>
          <input type="text" name="id" placeholder="ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ (Ï€.Ï‡. bags)" required />
          <input type="text" name="name" placeholder="ÎŒÎ½Î¿Î¼Î± (Ï€.Ï‡. Î¤ÏƒÎ¬Î½Ï„ÎµÏ‚)" required />
          <input type="text" name="slug" placeholder="Slug (Ï€.Ï‡. tsantes)" required />
          <select name="parentId">
            <option value=""><%= t('admin.catNoParent') %></option>
            <% categories.forEach(function(cat){ %>
              <option value="<%= cat.id %>"><%= cat.name %> (<%= cat.id %>)</option>
            <% }) %>
          </select>
          <input type="password" name="password" placeholder="ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®" required />
          <button type="submit" class="button"><%= t('admin.catAddBtn') %></button>
        </form>

        <form method="POST" action="/admin/categories/update" class="admin-subform">
          <h3><%= t('admin.catUpdateTitle') %></h3>
          <select name="categoryId">
            <% categories.forEach(function(cat){ %>
              <option value="<%= cat.id %>"><%= cat.name %> (<%= cat.id %>)</option>
            <% }) %>
          </select>
          <input type="text" name="name" placeholder="ÎÎ­Î¿ ÏŒÎ½Î¿Î¼Î±" required />
          <input type="text" name="slug" placeholder="ÎÎ­Î¿ slug" required />
          <select name="parentId">
            <option value=""><%= t('admin.catNoParent') %></option>
            <% categories.forEach(function(cat){ %>
              <option value="<%= cat.id %>"><%= cat.name %> (<%= cat.id %>)</option>
            <% }) %>
          </select>
          <input type="password" name="password" placeholder="ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®" required />
          <button type="submit" class="button"><%= t('admin.catUpdateBtn') %></button>
        </form>
        <% } else { %>
          <p class="helper"><%= t('admin.catManagedNote') %></p>
        <% } %>
      </section>


      <%# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• %>
      <%#   TAB 3 â€“ PRODUCTS (table + modal editor)                 %>
      <%# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• %>
      <section id="tab-products" class="admin-block">
        <h2><%= t('admin.productsTitle') %></h2>
        <p class="helper">
          <%= t('admin.productsHelper') %>
          <% if (!permissions.canEditProducts) { %>
            <br><em><%= t('admin.productsManagedNote') %></em>
          <% } %>
        </p>

        <% if (permissions.canEditProducts) { %>
          <button class="button" id="btn-add-product" type="button"><%= t('admin.addProduct') %></button>
        <% } %>

        <table class="products-table" id="products-table">
          <thead>
            <tr>
              <th></th>
              <th><%= t('admin.colName') %></th>
              <th><%= t('admin.colPrice') %></th>
              <th><%= t('admin.colSku') %></th>
              <th><%= t('admin.colCategory') %></th>
              <% if (permissions.canEditProducts) { %><th><%= t('admin.colActions') %></th><% } %>
            </tr>
          </thead>
          <tbody id="products-tbody">
            <%# Rendered by JS below %>
          </tbody>
        </table>

        <%# Hidden form that submits the serialized JSON array to the backend %>
        <form id="products-save-form" method="POST" action="/admin/products">
          <input type="hidden" name="productsJson" id="products-json-input" />
          <% if (permissions.canEditProducts) { %>
          <div class="save-row">
            <label style="flex:1 1 auto;font-size:0.86rem;">
              <%= t('admin.savePassLabel') %>
            </label>
            <input type="password" name="password" required placeholder="<%= t('admin.adminPass') %>" />
            <button type="submit" class="button"><%= t('admin.saveAll') %></button>
          </div>
          <% } %>
        </form>
      </section>


      <%# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• %>
      <%#   TAB 4 â€“ IMAGE UPLOAD                                    %>
      <%# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• %>
      <section id="tab-upload" class="admin-block">
        <h2><%= t('admin.imagesTitle') %></h2>
        <p class="helper"><%= t('admin.imagesHelper') %></p>
        <form id="upload-form" enctype="multipart/form-data">
          <input type="file" name="image" accept="image/*"
                 <%= permissions.canUploadMedia ? '' : 'disabled' %> required />
          <input type="password" name="password" placeholder="ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®"
                 <%= permissions.canUploadMedia ? 'required' : 'disabled' %> />
          <button class="button" type="submit"
                  <%= permissions.canUploadMedia ? '' : 'disabled' %>><%= t('admin.uploadBtn') %></button>
        </form>
        <p id="upload-result"></p>
        <% if (!permissions.canUploadMedia) { %>
          <p class="helper"><%= t('admin.imagesManagedNote') %></p>
        <% } %>

        <%# â”€â”€ Favicon â”€â”€ %>
        <hr style="margin:28px 0 22px;border:none;border-top:1px solid #e5e7eb;" />
        <h3 style="margin-bottom:6px;"><%= t('admin.faviconTitle') %></h3>
        <p class="helper"><%= t('admin.faviconHelper') %></p>

        <% if (hasFavicon) { %>
          <div style="display:flex;align-items:center;gap:16px;margin-bottom:14px;">
            <img src="/favicon.ico?v=<%= Date.now() %>" alt="favicon"
                 style="width:48px;height:48px;object-fit:contain;border:1px solid #e5e7eb;border-radius:6px;padding:4px;background:#f9fafb;" />
            <div>
              <p style="margin:0 0 6px;font-size:0.85rem;color:#374151;font-weight:500;">Î¤ÏÎ­Ï‡Î¿Î½ favicon</p>
              <form method="POST" action="/admin/favicon/delete" style="display:inline;">
                <input type="hidden" name="password" id="fav-del-pw" value="" />
                <button class="button" type="button" style="font-size:0.8rem;padding:4px 10px;background:#fee2e2;color:#b91c1c;border:1px solid #fca5a5;"
                        onclick="deleteFavicon(this)"><%= t('admin.faviconDelete') %></button>
              </form>
            </div>
          </div>
        <% } else { %>
          <p style="color:#9ca3af;font-size:0.85rem;margin-bottom:14px;"><%= t('admin.faviconNone') %></p>
        <% } %>

        <form method="POST" action="/admin/favicon" enctype="multipart/form-data" style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;">
          <input type="file" name="favicon" accept="image/png,image/jpeg,image/x-icon,image/svg+xml" required />
          <input type="password" name="password" placeholder="<%= t('admin.passwordPlaceholder') %>" required style="width:180px;" />
          <button class="button" type="submit"><%= t('admin.faviconUploadBtn') %></button>
        </form>
        <p style="font-size:0.78rem;color:#9ca3af;margin-top:6px;">PNG / ICO / SVG Â· max 512 KB</p>
      </section>

      <%# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• %>
      <%#   TAB 5 â€“ SHIPPING & PAYMENT                              %>
      <%# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• %>
      <section id="tab-shipping" class="admin-block">
        <h2><%= t('admin.shippingTitle') %></h2>
        <p class="helper"><%= t('admin.shippingHelper') %></p>

        <% if (!permissions.canEditSettings) { %>
          <p class="helper"><%= t('admin.shippingManagedNote') %></p>
        <% } %>

        <form method="POST" action="/admin/shipping-payment">

          <%# â”€â”€ Shipping options â”€â”€ %>
          <h3><%= t('admin.shippingOptionsTitle') %></h3>
          <% if ((config.shippingOptions || []).length === 0) { %>
            <p class="helper" style="color:#888;"><%= t('admin.shippingNone') %></p>
          <% } else { %>
          <table class="sp-table">
            <thead>
              <tr>
                <th><%= t('admin.shipColId') %></th>
                <th><%= t('admin.shipColLabel') %></th>
                <th><%= t('admin.shipColBase') %></th>
                <th><%= t('admin.shipColCodFee') %></th>
                <th><%= t('admin.shipColAllowed') %></th>
              </tr>
            </thead>
            <tbody>
              <% (config.shippingOptions || []).forEach(function(opt, i) { %>
              <tr>
                <td><span class="sp-badge"><%= opt.id %></span></td>
                <td>
                  <input type="text" name="ship_label_<%= i %>"
                         value="<%= opt.label || '' %>"
                         <%= permissions.canEditSettings ? 'required' : 'readonly' %> />
                </td>
                <td>
                  <input type="number" name="ship_base_<%= i %>"
                         value="<%= opt.base !== undefined ? opt.base : 0 %>"
                         min="0" step="0.01"
                         <%= permissions.canEditSettings ? '' : 'readonly' %> />
                </td>
                <td>
                  <input type="number" name="ship_codFee_<%= i %>"
                         value="<%= opt.codFee !== undefined ? opt.codFee : 0 %>"
                         min="0" step="0.01"
                         <%= permissions.canEditSettings ? '' : 'readonly' %> />
                </td>
                <td>
                  <% (opt.allowedPaymentMethods || []).forEach(function(pm) { %>
                    <span class="sp-badge"><%= pm %></span>
                  <% }) %>
                </td>
              </tr>
              <% }) %>
            </tbody>
          </table>
          <% } %>
          <p class="helper" style="margin-top:6px;"><%= t('admin.shipCostHelper') %></p>

          <%# â”€â”€ Payment options â”€â”€ %>
          <h3><%= t('admin.paymentOptionsTitle') %></h3>
          <% if ((config.paymentOptions || []).length === 0) { %>
            <p class="helper" style="color:#888;"><%= t('admin.paymentNone') %></p>
          <% } else { %>
          <table class="sp-table">
            <thead>
              <tr>
                <th><%= t('admin.payColId') %></th>
                <th><%= t('admin.payColLabel') %></th>
                <th><%= t('admin.payColType') %></th>
              </tr>
            </thead>
            <tbody>
              <% (config.paymentOptions || []).forEach(function(opt, i) { %>
              <tr>
                <td><span class="sp-badge"><%= opt.id %></span></td>
                <td>
                  <input type="text" name="pay_label_<%= i %>"
                         value="<%= opt.label || '' %>"
                         <%= permissions.canEditSettings ? 'required' : 'readonly' %> />
                </td>
                <td><span class="sp-badge"><%= opt.type || 'â€“' %></span></td>
              </tr>
              <% }) %>
            </tbody>
          </table>
          <% } %>
          <% if (permissions.canEditSettings) { %>
          <div class="save-row">
            <label style="flex:1 1 auto;font-size:0.86rem;"><%= t('admin.adminPass') %>:</label>
            <input type="password" name="password" required placeholder="<%= t('admin.adminPass') %>" />
            <button type="submit" class="button"><%= t('admin.shippingSave') %></button>
          </div>
          <% } %>

        </form>
      </section>

      <%# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• %>
      <%#   TAB 7 â€“ NOTIFICATIONS                                   %>
      <%# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• %>
      <section id="tab-notifications" class="admin-block">
        <h2><%= t('admin.notificationsTitle') %></h2>
        <p class="helper"><%= t('admin.notificationsHelper') %></p>

        <div class="notifications-skeleton">
          <table class="sp-table" style="opacity:.5;">
            <thead>
              <tr>
                <th><%= t('admin.notifColDate') %></th>
                <th><%= t('admin.notifColSubject') %></th>
                <th><%= t('admin.notifColRecipients') %></th>
                <th><%= t('admin.notifColStatus') %></th>
                <th><%= t('admin.notifColHash') %></th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="5" style="text-align:center;color:#aaa;font-style:italic;padding:24px 0;">
                  <%= t('admin.notificationsComingSoon') %>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>


      <%# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• %>
      <%#   TAB 8 â€“ INVENTORY                                       %>
      <%# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• %>
      <section id="tab-inventory" class="admin-block">
        <h2><%= t('admin.inventoryTitle') %></h2>
        <p class="helper"><%= t('admin.inventoryHelper') %></p>

        <%# â”€â”€ Stock table â”€â”€ %>
        <h3><%= t('admin.inventoryStockTitle') %></h3>
        <table class="sp-table" id="inv-stock-table">
          <thead>
            <tr>
              <th><%= t('admin.invColProduct') %></th>
              <th><%= t('admin.invColSku') %></th>
              <th><%= t('admin.invColStock') %></th>
              <th><%= t('admin.invColStatus') %></th>
              <th><%= t('admin.invColViews') %></th>
              <th><%= t('admin.invColOrders') %></th>
            </tr>
          </thead>
          <tbody>
            <% products.forEach(function(p) { %>
              <% const s = p.stock !== undefined ? p.stock : 'â€“'; %>
              <% const sNum = typeof s === 'number' ? s : parseInt(s); %>
              <% const statusClass = s === 'â€“' ? '' : sNum === 0 ? 'stock-out' : sNum < 3 ? 'stock-low' : 'stock-ok'; %>
              <tr>
                <td>
                  <% if (p.imageUrl) { %><img src="<%= p.imageUrl %>" style="width:28px;height:28px;object-fit:cover;border-radius:3px;vertical-align:middle;margin-right:6px;" /><% } %>
                  <%= p.name %>
                  <% if (p.featured) { %><span style="color:#f59e0b;font-size:.75rem;margin-left:4px;">â­</span><% } %>
                </td>
                <td style="color:#888;font-size:.82rem;"><%= p.sku || 'â€“' %></td>
                <td style="font-weight:600;"><%= s %></td>
                <td>
                  <% if (s !== 'â€“') { %>
                    <% if (sNum === 0) { %>
                      <span class="sp-badge" style="background:#fee2e2;color:#991b1b;"><%= t('admin.invStatusOut') %></span>
                    <% } else if (sNum < 3) { %>
                      <span class="sp-badge" style="background:#fef3c7;color:#92400e;"><%= t('admin.invStatusLow') %></span>
                    <% } else { %>
                      <span class="sp-badge" style="background:#d1fae5;color:#065f46;"><%= t('admin.invStatusOk') %></span>
                    <% } %>
                  <% } else { %>â€“<% } %>
                </td>
                <td style="font-size:.85rem;"><%= analytics.pageViews[p.id] || 0 %></td>
                <td style="font-size:.85rem;font-weight:600;"><%= orderCounts[p.id] || 0 %></td>
              </tr>
            <% }) %>
            <% if (!products.length) { %>
              <tr><td colspan="6" style="color:#aaa;text-align:center;padding:20px;"><%= t('admin.noProductsYet') %></td></tr>
            <% } %>
          </tbody>
        </table>

        <%# â”€â”€ Orders by product bar chart â”€â”€ %>
        <% const chartProducts = products.filter(function(p){ return (orderCounts[p.id]||0) > 0; }); %>
        <% if (chartProducts.length > 0) { %>
        <h3 style="margin-top:24px;"><%= t('admin.chartOrdersTitle') %></h3>
        <% const maxOrders = Math.max.apply(null, chartProducts.map(function(p){ return orderCounts[p.id]||0; })); %>
        <div style="display:flex;flex-direction:column;gap:6px;margin-bottom:20px;">
          <% chartProducts.sort(function(a,b){ return (orderCounts[b.id]||0)-(orderCounts[a.id]||0); }).forEach(function(p) { %>
            <div style="display:flex;align-items:center;gap:10px;font-size:.84rem;">
              <span style="width:160px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;"><%= p.name %></span>
              <div style="flex:1;background:#f0f2fa;border-radius:4px;overflow:hidden;height:18px;">
                <div style="width:<%= Math.round((orderCounts[p.id]||0)/maxOrders*100) %>%;background:var(--accent-color,#5b6af5);height:100%;border-radius:4px;"></div>
              </div>
              <span style="width:28px;text-align:right;font-weight:700;"><%= orderCounts[p.id]||0 %></span>
            </div>
          <% }); %>
        </div>
        <% } %>

        <%# â”€â”€ Top cities â”€â”€ %>
        <% const cityEntries = Object.entries(cityCounts).sort(function(a,b){ return b[1]-a[1]; }).slice(0,10); %>
        <% if (cityEntries.length > 0) { %>
        <h3 style="margin-top:24px;"><%= t('admin.chartCitiesTitle') %></h3>
        <% const maxCityOrders = cityEntries[0][1]; %>
        <div style="display:flex;flex-direction:column;gap:6px;margin-bottom:20px;">
          <% cityEntries.forEach(function(entry) { %>
            <div style="display:flex;align-items:center;gap:10px;font-size:.84rem;">
              <span style="width:140px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">ğŸ“ <%= entry[0] %></span>
              <div style="flex:1;background:#f0f2fa;border-radius:4px;overflow:hidden;height:18px;">
                <div style="width:<%= Math.round(entry[1]/maxCityOrders*100) %>%;background:#10b981;height:100%;border-radius:4px;"></div>
              </div>
              <span style="width:28px;text-align:right;font-weight:700;"><%= entry[1] %></span>
            </div>
          <% }); %>
        </div>
        <% } %>

        <%# â”€â”€ Manual stock adjustment â”€â”€ %>
        <% if (permissions.canEditProducts) { %>
        <h3 style="margin-top:24px;"><%= t('admin.invAdjustTitle') %></h3>
        <form method="POST" action="/admin/stock/adjust" class="admin-subform" style="display:flex;gap:10px;flex-wrap:wrap;align-items:flex-end;">
          <label style="flex:1;min-width:140px;">
            <%= t('admin.invAdjustProduct') %>
            <select name="productId" style="margin-top:4px;">
              <% products.forEach(function(p) { %>
                <option value="<%= p.id %>"><%= p.name %> (<%= p.stock !== undefined ? p.stock : 'â€“' %>)</option>
              <% }) %>
            </select>
          </label>
          <label style="flex:0 0 90px;">
            <%= t('admin.invAdjustQty') %>
            <input type="number" name="newStock" min="0" step="1" value="0" style="margin-top:4px;" />
          </label>
          <label style="flex:1;min-width:140px;">
            <%= t('admin.invAdjustReason') %>
            <input type="text" name="reason" placeholder="Ï€.Ï‡. Î±Î½Î±Ï€Î»Î®ÏÏ‰ÏƒÎ·" style="margin-top:4px;" />
          </label>
          <label style="flex:0 0 160px;">
            <%= t('admin.adminPass') %>
            <input type="password" name="password" required style="margin-top:4px;" />
          </label>
          <button class="button" type="submit" style="align-self:flex-end;"><%= t('admin.invAdjustBtn') %></button>
        </form>
        <% } %>

        <%# â”€â”€ Stock movement log â”€â”€ %>
        <h3 style="margin-top:24px;"><%= t('admin.invLogTitle') %></h3>
        <% if (stockLog.length === 0) { %>
          <p class="helper" style="color:#aaa;"><%= t('admin.invLogEmpty') %></p>
        <% } else { %>
        <table class="sp-table" style="font-size:.83rem;">
          <thead>
            <tr>
              <th><%= t('admin.invLogDate') %></th>
              <th><%= t('admin.invLogProduct') %></th>
              <th><%= t('admin.invLogDelta') %></th>
              <th><%= t('admin.invLogReason') %></th>
              <th><%= t('admin.invLogOrder') %></th>
            </tr>
          </thead>
          <tbody>
            <% stockLog.forEach(function(e) { %>
            <tr>
              <td style="white-space:nowrap;color:#666;"><%= new Date(e.createdAt).toLocaleDateString(lang) %></td>
              <td><%= e.productName || e.productId %></td>
              <td style="font-weight:700;color:<%= e.delta < 0 ? '#dc2626' : '#16a34a' %>">
                <%= e.delta > 0 ? '+' + e.delta : e.delta %>
              </td>
              <td><%= e.reason %></td>
              <td style="font-size:.78rem;color:#aaa;font-family:monospace;"><%= e.orderId || 'â€“' %></td>
            </tr>
            <% }) %>
          </tbody>
        </table>
        <% } %>
      </section>

    </main>


    <%# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• %>
    <%#   PRODUCT MODAL                                           %>
    <%# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• %>
    <div class="modal-overlay" id="product-modal">
      <div class="modal-box">
        <h3 id="modal-title"><%= t('admin.modalNewProduct') %></h3>
        <div class="modal-grid">
          <label class="full"><span><%= t('admin.modalProductName') %></span>
            <input type="text" id="f-name" placeholder="Ï€.Ï‡. Î”ÎµÏÎ¼Î¬Ï„Î¹Î½Î· Ï„ÏƒÎ¬Î½Ï„Î±" />
          </label>
          <label><span><%= t('admin.modalProductId') %></span>
            <input type="text" id="f-id" placeholder="Ï€.Ï‡. bag-001" />
          </label>
          <label><span><%= t('admin.modalSku') %></span>
            <input type="text" id="f-sku" placeholder="Ï€.Ï‡. SKU-123" />
          </label>
          <label><span><%= t('admin.modalPrice') %></span>
            <input type="number" id="f-price" min="0" step="0.01" placeholder="0.00" />
          </label>
          <label><span><%= t('admin.modalStock') %></span>
            <input type="number" id="f-stock" min="0" step="1" placeholder="0" />
          </label>
          <label style="flex-direction:row;align-items:center;gap:8px;">
            <input type="checkbox" id="f-featured" style="width:auto;margin:0;" />
            <span><%= t('admin.modalFeatured') %></span>
          </label>
          <label class="full"><span><%= t('admin.modalCategory') %></span>
            <select id="f-category">
              <option value=""><%= t('admin.modalNoCat') %></option>
              <% categories.forEach(function(cat){ %>
                <option value="<%= cat.id %>"><%= cat.name %></option>
              <% }) %>
            </select>
          </label>
          <label class="full"><span><%= t('admin.modalImageUrl') %></span>
            <input type="text" id="f-imageUrl" placeholder="/tenants/.../media/photo.jpg" />
          </label>
          <label class="full"><span><%= t('admin.modalDescription') %></span>
            <textarea id="f-description" rows="3" placeholder="Î£ÏÎ½Ï„Î¿Î¼Î· Ï€ÎµÏÎ¹Î³ÏÎ±Ï†Î® Ï€ÏÎ¿ÏŠÏŒÎ½Ï„Î¿Ï‚..."></textarea>
          </label>
          <label class="full"><span><%= t('admin.modalSeoTitle') %></span>
            <input type="text" id="f-seoTitle" placeholder="<%= t('admin.modalSeoTitlePlaceholder') %>" />
          </label>
          <label class="full"><span><%= t('admin.modalSeoDescription') %></span>
            <input type="text" id="f-seoDescription" placeholder="<%= t('admin.modalSeoDescPlaceholder') %>" />
          </label>
          <label class="full"><span><%= t('admin.modalGallery') %></span>
            <textarea id="f-gallery" rows="3" placeholder="<%= t('admin.modalGalleryPlaceholder') %>"></textarea>
            <small style="color:#888;font-size:0.78rem;"><%= t('admin.modalGalleryHelper') %></small>
          </label>
          <div class="full">
            <span style="font-size:.86rem;font-weight:600;display:block;margin-bottom:6px;"><%= t('admin.modalSpecs') %></span>
            <small style="color:#888;font-size:.78rem;display:block;margin-bottom:8px;"><%= t('admin.modalSpecsHelper') %></small>
            <div id="specs-rows"></div>
            <button type="button" onclick="addSpecRow()" style="margin-top:6px;font-size:.8rem;padding:4px 10px;background:#f3f4f6;border:1px solid #d1d5db;border-radius:4px;cursor:pointer;">+ Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÎ¿Ï</button>
          </div>

          <div class="full" style="margin-top:14px;">
            <span style="font-size:.86rem;font-weight:600;display:block;margin-bottom:4px;"><%= t('admin.modalVariants') %></span>
            <small style="color:#888;font-size:.78rem;display:block;margin-bottom:8px;"><%= t('admin.modalVariantsHelper') %></small>
            <div id="variants-rows"></div>
            <button type="button" onclick="addVariantRow()" style="margin-top:6px;font-size:.8rem;padding:4px 10px;background:#f3f4f6;border:1px solid #d1d5db;border-radius:4px;cursor:pointer;">+ <%= t('admin.addVariant') %></button>
          </div>

          <% if (permissions.canDigitalContent) { %>
          <div class="full" style="margin-top:16px;padding:16px;background:#f0fdf4;border:1px solid #bbf7d0;border-radius:8px;">
            <p style="margin:0 0 10px;font-weight:700;font-size:.9rem;color:#15803d;">ğŸ Digital Content (ÎµÎ³Ï‡ÎµÎ¹ÏÎ¯Î´Î¹Î¿ / Î²Î¯Î½Ï„ÎµÎ¿)</p>
            <label style="display:flex;align-items:center;gap:8px;margin-bottom:12px;font-size:.87rem;">
              <input type="checkbox" id="f-hasDigitalContent" style="width:auto;margin:0;" />
              <span>Î‘Ï…Ï„ÏŒ Ï„Î¿ Ï€ÏÎ¿ÏŠÏŒÎ½ Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ digital Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ Î¼ÎµÏ„Î¬ Ï„Î·Î½ Î±Î³Î¿ÏÎ¬</span>
            </label>
            <label style="display:flex;flex-direction:column;gap:4px;font-size:.86rem;margin-bottom:10px;">
              <span>Î ÎµÏÎ¹Î³ÏÎ±Ï†Î® Ï€ÎµÏÎ¹ÎµÏ‡Î¿Î¼Î­Î½Î¿Ï… <small style="color:#6b7280;">(ÎµÎ¼Ï†Î±Î½Î¯Î¶ÎµÏ„Î±Î¹ ÏƒÏ„Î· ÏƒÎµÎ»Î¯Î´Î± Ï„Î¿Ï… Ï€ÏÎ¿ÏŠÏŒÎ½Ï„Î¿Ï‚)</small></span>
              <textarea id="f-contentDescription" rows="2"
                        style="padding:7px 10px;border:1px solid #d1d5db;border-radius:4px;font-size:.85rem;resize:vertical;"
                        placeholder="Ï€.Ï‡. Î•Î³Ï‡ÎµÎ¹ÏÎ¯Î´Î¹Î¿ ÎµÎ³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Ï‚ 28 ÏƒÎµÎ»Î¯Î´Ï‰Î½ + Î²Î¯Î½Ï„ÎµÎ¿ Ï„Î¿Ï€Î¿Î¸Î­Ï„Î·ÏƒÎ·Ï‚ 12 Î»ÎµÏ€Ï„ÏÎ½"></textarea>
            </label>
            <label style="display:flex;flex-direction:column;gap:4px;font-size:.86rem;margin-bottom:10px;">
              <span>URL ÎµÎ³Ï‡ÎµÎ¹ÏÎ¹Î´Î¯Î¿Ï… PDF <small style="color:#6b7280;">(Î® Î±Î½ÎµÎ²Î¬ÏƒÏ„Îµ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰)</small></span>
              <div style="display:flex;gap:6px;">
                <input type="text" id="f-manualUrl"
                       style="flex:1;padding:7px 10px;border:1px solid #d1d5db;border-radius:4px;font-size:.85rem;"
                       placeholder="/tenants/demo/media/manual.pdf" />
                <label style="cursor:pointer;white-space:nowrap;">
                  <input type="file" id="f-manual-file" accept="application/pdf,video/mp4,video/webm" style="display:none;" onchange="uploadManual(this)" />
                  <span style="display:inline-block;padding:7px 12px;background:#e0f2fe;color:#0369a1;border:1px solid #bae6fd;border-radius:4px;font-size:.82rem;font-weight:600;">â¬† Î‘Î½Î­Î²Î±ÏƒÎ¼Î±</span>
                </label>
              </div>
              <small id="manual-upload-status" style="color:#6b7280;font-size:.77rem;"></small>
            </label>
            <label style="display:flex;flex-direction:column;gap:4px;font-size:.86rem;">
              <span>URL Î²Î¯Î½Ï„ÎµÎ¿ Î¿Î´Î·Î³Î¹ÏÎ½ <small style="color:#6b7280;">(YouTube, Vimeo Î® .mp4)</small></span>
              <input type="text" id="f-videoUrl"
                     style="padding:7px 10px;border:1px solid #d1d5db;border-radius:4px;font-size:.85rem;"
                     placeholder="https://youtu.be/..." />
            </label>
          </div>
          <% } %>

        </div>
        <div class="modal-actions">
          <button class="button" type="button" id="modal-cancel"
                  style="background:#eee;color:#333;"><%= t('admin.modalCancel') %></button>
          <button class="button" type="button" id="modal-save"><%= t('admin.modalSave') %></button>
        </div>
      </div>
    </div>


    <script>
      // â”€â”€ i18n strings for JS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const i18nJs = {
        noProducts:    '<%- t("admin.noProductsYet") %>',
        newProduct:    '<%- t("admin.modalNewProduct") %>',
        editPrefix:    '<%- t("admin.modalEditPrefix") %>',
        editBtn:       '<%- t("admin.editProduct") %>',
        deleteBtn:     '<%- t("admin.deleteProduct") %>',
        nameRequired:  '<%- t("admin.jsNameIdRequired") %>',
        uploading:     '<%- t("admin.jsUploading") %>',
        uploadOk:      '<%- t("admin.jsUploadComplete") %>',
        uploadErr:     '<%- t("admin.jsUploadError") %>',
        logoOk:        '<%- t("admin.jsLogoUploaded") %>',
        selectFile:    '<%- t("admin.jsSelectFile") %>',
        enterPass:     '<%- t("admin.jsEnterPassword") %>'
      };

      // â”€â”€ Products data (server-rendered) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      let products = <%- productsJson %>;
      const canEdit = <%= permissions.canEditProducts ? 'true' : 'false' %>;

      // â”€â”€ Render table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      function renderTable() {
        const tbody = document.getElementById('products-tbody');
        if (!products.length) {
          tbody.innerHTML = '<tr><td colspan="' + (canEdit ? 6 : 5) + '" style="color:#888;font-style:italic;">' + i18nJs.noProducts + '</td></tr>';
          return;
        }
        tbody.innerHTML = products.map((p, i) => {
          const img = p.imageUrl
            ? '<img class="thumb" src="' + escHtml(p.imageUrl) + '" alt="" loading="lazy">'
            : '<span class="no-img"></span>';
          const editBtn = canEdit
            ? '<button class="btn-sm edit" type="button" onclick="openEdit(' + i + ')">' + i18nJs.editBtn + '</button> ' +
              '<button class="btn-sm del" type="button" onclick="deleteProduct(' + i + ')">' + i18nJs.deleteBtn + '</button>'
            : '';
          return '<tr>' +
            '<td>' + img + '</td>' +
            '<td>' + escHtml(p.name || '') + '</td>' +
            '<td>' + (p.price !== undefined ? Number(p.price).toFixed(2) : 'â€“') + '</td>' +
            '<td>' + escHtml(p.sku || '') + '</td>' +
            '<td>' + escHtml(p.categoryId || '') + '</td>' +
            (canEdit ? '<td>' + editBtn + '</td>' : '') +
            '</tr>';
        }).join('');
      }

      function escHtml(s) {
        return String(s)
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;');
      }

      // â”€â”€ Modal logic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      let editingIdx = -1; // -1 = new product

      const modal       = document.getElementById('product-modal');
      const fName       = document.getElementById('f-name');
      const fId         = document.getElementById('f-id');
      const fSku        = document.getElementById('f-sku');
      const fPrice      = document.getElementById('f-price');
      const fStock      = document.getElementById('f-stock');
      const fFeatured   = document.getElementById('f-featured');
      const fCat        = document.getElementById('f-category');
      const fImg        = document.getElementById('f-imageUrl');
      const fDesc       = document.getElementById('f-description');
      const fSeoTitle   = document.getElementById('f-seoTitle');
      const fSeoDesc    = document.getElementById('f-seoDescription');
      const fGallery    = document.getElementById('f-gallery');
      const mTitle      = document.getElementById('modal-title');

      // â”€â”€ Digital content fields (may be null if tier doesn't support) â”€â”€
      const fHasDigital    = document.getElementById('f-hasDigitalContent');
      const fContentDesc   = document.getElementById('f-contentDescription');
      const fManualUrl     = document.getElementById('f-manualUrl');
      const fVideoUrl      = document.getElementById('f-videoUrl');

      async function uploadManual(input) {
        const file = input.files[0];
        if (!file) return;
        const statusEl = document.getElementById('manual-upload-status');
        const pw = document.querySelector('input[name="password"]') ||
                   { value: prompt('ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î® Î³Î¹Î± Î±Î½Î­Î²Î±ÏƒÎ¼Î±:') };
        statusEl.textContent = 'Î‘Î½Î­Î²Î±ÏƒÎ¼Î±...';
        const fd = new FormData();
        fd.append('manual', file);
        fd.append('password', pw.value || '');
        try {
          const res = await fetch('/admin/upload-manual', { method: 'POST', body: fd });
          const j = await res.json();
          if (j.ok) {
            if (fManualUrl) fManualUrl.value = j.url;
            statusEl.style.color = '#059669';
            statusEl.textContent = 'âœ“ Î‘Î½Î­Î²Î·ÎºÎµ: ' + j.url;
          } else {
            statusEl.style.color = '#dc2626';
            statusEl.textContent = j.error || 'Î£Ï†Î¬Î»Î¼Î± Î±Î½ÎµÎ²Î¬ÏƒÎ¼Î±Ï„Î¿Ï‚.';
          }
        } catch(e) {
          statusEl.style.color = '#dc2626';
          statusEl.textContent = 'Î£Ï†Î¬Î»Î¼Î± Î´Î¹ÎºÏ„ÏÎ¿Ï….';
        }
        input.value = '';
      }

      // â”€â”€ Specs dynamic rows â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      function renderSpecRows(specs) {
        const container = document.getElementById('specs-rows');
        container.innerHTML = '';
        (specs || []).forEach(function(s) { addSpecRow(s.k, s.v); });
      }

      function addSpecRow(k, v) {
        const container = document.getElementById('specs-rows');
        const row = document.createElement('div');
        row.style.cssText = 'display:flex;gap:6px;margin-bottom:6px;';
        row.innerHTML =
          '<input type="text" placeholder="Î§Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÏŒ" value="' + (k || '').replace(/"/g,'&quot;') + '" class="spec-k" style="flex:1;padding:5px 8px;border:1px solid #d1d5db;border-radius:4px;font-size:.84rem;" />' +
          '<input type="text" placeholder="Î¤Î¹Î¼Î®" value="' + (v || '').replace(/"/g,'&quot;') + '" class="spec-v" style="flex:1;padding:5px 8px;border:1px solid #d1d5db;border-radius:4px;font-size:.84rem;" />' +
          '<button type="button" onclick="this.closest(\'div\').remove()" style="background:#fee2e2;color:#dc2626;border:none;border-radius:4px;padding:4px 8px;cursor:pointer;">Ã—</button>';
        container.appendChild(row);
      }

      function readSpecRows() {
        const rows = document.querySelectorAll('#specs-rows > div');
        const result = [];
        rows.forEach(function(row) {
          const k = (row.querySelector('.spec-k').value || '').trim();
          const v = (row.querySelector('.spec-v').value || '').trim();
          if (k && v) result.push({ k, v });
        });
        return result;
      }

      // â”€â”€ Variant dynamic rows â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      function renderVariantRows(variants) {
        const container = document.getElementById('variants-rows');
        container.innerHTML = '';
        (variants || []).forEach(function(v) { addVariantRow(v); });
      }

      function addVariantRow(v) {
        v = v || {};
        const container = document.getElementById('variants-rows');
        const row = document.createElement('div');
        row.className = 'variant-row';
        row.dataset.vid = v.id || '';
        row.style.cssText = 'background:#f9fafb;border:1px solid #e5e7eb;border-radius:6px;padding:10px 12px;margin-bottom:8px;display:grid;grid-template-columns:1fr 90px 80px;gap:6px;';
        row.innerHTML =
          '<input class="v-label" type="text" placeholder="<%= t("admin.variantLabel") %>" value="' + escHtml(v.label || '') + '" style="padding:5px 8px;border:1px solid #d1d5db;border-radius:4px;font-size:.84rem;" />' +
          '<input class="v-price" type="number" step="0.01" min="0" placeholder="<%= t("admin.variantPrice") %>" value="' + (v.price !== undefined ? v.price : '') + '" style="padding:5px 8px;border:1px solid #d1d5db;border-radius:4px;font-size:.84rem;" />' +
          '<input class="v-stock" type="number" min="0" placeholder="<%= t("admin.variantStock") %>" value="' + (v.stock !== undefined ? v.stock : '') + '" style="padding:5px 8px;border:1px solid #d1d5db;border-radius:4px;font-size:.84rem;" />' +
          '<input class="v-video" type="text" placeholder="URL Î²Î¯Î½Ï„ÎµÎ¿" value="' + escHtml(v.videoUrl || '') + '" style="grid-column:1/3;padding:5px 8px;border:1px solid #d1d5db;border-radius:4px;font-size:.82rem;" />' +
          '<button type="button" onclick="this.closest(\'.variant-row\').remove()" style="grid-column:3;background:#fee2e2;color:#dc2626;border:none;border-radius:4px;padding:4px 6px;cursor:pointer;font-size:.9rem;">Ã—</button>' +
          '<textarea class="v-desc" rows="2" placeholder="<%= t("admin.variantDesc") %>" style="grid-column:1/4;padding:5px 8px;border:1px solid #d1d5db;border-radius:4px;font-size:.82rem;resize:vertical;">' + escHtml(v.contentDescription || '') + '</textarea>';
        container.appendChild(row);
      }

      function readVariantRows() {
        const rows = document.querySelectorAll('#variants-rows .variant-row');
        const result = [];
        rows.forEach(function(row) {
          const label = (row.querySelector('.v-label').value || '').trim();
          if (!label) return;
          const existingId = row.dataset.vid;
          const id = existingId || label.toLowerCase().replace(/[^a-z0-9\u0370-\u03ff]+/g, '-').replace(/^-+|-+$/g, '') || ('v' + Date.now());
          const price = parseFloat(row.querySelector('.v-price').value);
          const stock = parseInt(row.querySelector('.v-stock').value, 10);
          const videoUrl = (row.querySelector('.v-video').value || '').trim() || undefined;
          const contentDescription = (row.querySelector('.v-desc').value || '').trim() || undefined;
          result.push({
            id,
            label,
            price:  isNaN(price) ? 0 : price,
            stock:  isNaN(stock) ? 0 : stock,
            videoUrl,
            contentDescription
          });
        });
        return result;
      }

      function clearDigitalFields() {
        if (fHasDigital)  fHasDigital.checked = false;
        if (fContentDesc) fContentDesc.value  = '';
        if (fManualUrl)   fManualUrl.value    = '';
        if (fVideoUrl)    fVideoUrl.value     = '';
      }

      function fillDigitalFields(p) {
        if (fHasDigital)  fHasDigital.checked = !!p.hasDigitalContent;
        if (fContentDesc) fContentDesc.value  = p.contentDescription || '';
        if (fManualUrl)   fManualUrl.value    = p.manualUrl  || '';
        if (fVideoUrl)    fVideoUrl.value     = p.videoUrl   || '';
      }

      function readDigitalFields() {
        return {
          hasDigitalContent: fHasDigital  ? fHasDigital.checked || undefined : undefined,
          contentDescription: fContentDesc ? fContentDesc.value.trim() || undefined : undefined,
          manualUrl:  fManualUrl ? fManualUrl.value.trim()  || undefined : undefined,
          videoUrl:   fVideoUrl  ? fVideoUrl.value.trim()   || undefined : undefined
        };
      }

      function openAdd() {
        editingIdx = -1;
        mTitle.textContent = i18nJs.newProduct;
        fName.value = ''; fId.value = ''; fSku.value = '';
        fPrice.value = ''; fStock.value = '1'; fFeatured.checked = false;
        fCat.value = ''; fImg.value = ''; fDesc.value = '';
        fSeoTitle.value = ''; fSeoDesc.value = ''; fGallery.value = '';
        renderSpecRows([]);
        renderVariantRows([]);
        clearDigitalFields();
        modal.classList.add('open');
        fName.focus();
      }

      function openEdit(i) {
        editingIdx = i;
        const p = products[i];
        mTitle.textContent = i18nJs.editPrefix + (p.name || '');
        fName.value       = p.name || '';
        fId.value         = p.id || '';
        fSku.value        = p.sku || '';
        fPrice.value      = p.price !== undefined ? p.price : '';
        fStock.value      = p.stock !== undefined ? p.stock : '';
        fFeatured.checked = !!p.featured;
        fCat.value        = p.categoryId || '';
        fImg.value        = p.imageUrl || '';
        fDesc.value       = p.description || '';
        fSeoTitle.value   = p.seoTitle || '';
        fSeoDesc.value    = p.seoDescription || '';
        fGallery.value    = Array.isArray(p.gallery) ? p.gallery.join('\n') : '';
        renderSpecRows(Array.isArray(p.specs) ? p.specs : []);
        renderVariantRows(Array.isArray(p.variants) ? p.variants : []);
        fillDigitalFields(p);
        modal.classList.add('open');
        fName.focus();
      }

      function closeModal() { modal.classList.remove('open'); }

      document.getElementById('modal-cancel').addEventListener('click', closeModal);
      modal.addEventListener('click', function(e) { if (e.target === modal) closeModal(); });

      document.getElementById('modal-save').addEventListener('click', function() {
        const name = fName.value.trim();
        const id   = fId.value.trim();
        if (!name || !id) {
          alert(i18nJs.nameRequired);
          return;
        }
        const galleryRaw    = fGallery.value.split('\n').map(l => l.trim()).filter(Boolean);
        const specsRows     = readSpecRows();
        const variantRows   = readVariantRows();
        const digitalFields = readDigitalFields();
        const product = {
          id,
          name,
          sku:            fSku.value.trim() || undefined,
          price:          parseFloat(fPrice.value) || 0,
          stock:          parseInt(fStock.value, 10) || 0,
          featured:       fFeatured.checked || undefined,
          categoryId:     fCat.value || undefined,
          imageUrl:       fImg.value.trim() || undefined,
          description:    fDesc.value.trim() || undefined,
          seoTitle:       fSeoTitle.value.trim() || undefined,
          seoDescription: fSeoDesc.value.trim() || undefined,
          gallery:        galleryRaw.length  ? galleryRaw  : undefined,
          specs:          specsRows.length   ? specsRows   : undefined,
          variants:       variantRows.length ? variantRows : undefined,
          ...digitalFields
        };
        // Remove undefined fields
        Object.keys(product).forEach(k => product[k] === undefined && delete product[k]);

        if (editingIdx === -1) {
          products.push(product);
        } else {
          products[editingIdx] = product;
        }
        closeModal();
        renderTable();
      });

      function deleteProduct(i) {
        if (!confirm(i18nJs.editPrefix.replace(': ','') + ' "' + (products[i].name || i) + '" ;')) return;
        products.splice(i, 1);
        renderTable();
      }

      // â”€â”€ Add button â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const btnAdd = document.getElementById('btn-add-product');
      if (btnAdd) btnAdd.addEventListener('click', openAdd);

      // â”€â”€ Serialize before submit â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const saveForm = document.getElementById('products-save-form');
      if (saveForm) {
        saveForm.addEventListener('submit', function() {
          document.getElementById('products-json-input').value = JSON.stringify(products);
        });
      }

      // â”€â”€ Initial render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      renderTable();


      // â”€â”€ Image upload â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const uploadForm   = document.getElementById('upload-form');
      const uploadResult = document.getElementById('upload-result');

      if (uploadForm) {
        uploadForm.addEventListener('submit', async function(e) {
          e.preventDefault();
          uploadResult.textContent = i18nJs.uploading;
          const formData = new FormData(uploadForm);
          const response = await fetch('/admin/upload-image', { method: 'POST', body: formData });
          const json = await response.json();
          if (json.ok) {
            uploadResult.innerHTML = i18nJs.uploadOk + '<code>' + json.url + '</code>';
          } else {
            uploadResult.textContent = json.error || i18nJs.uploadErr;
          }
        });
      }

      // â”€â”€ Color pickers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      function bindColorPair(textId, pickerId) {
        const txt  = document.getElementById(textId);
        const pick = document.getElementById(pickerId);
        if (!txt || !pick) return;
        pick.addEventListener('input', () => { txt.value = pick.value; });
        txt.addEventListener('input', () => {
          if (/^#[0-9a-f]{6}$/i.test(txt.value)) pick.value = txt.value;
        });
      }
      bindColorPair('txt-primaryColor',       'cp-primaryColor');
      bindColorPair('txt-accentColor',        'cp-accentColor');
      bindColorPair('txt-themeMenuBg',        'cp-themeMenuBg');
      bindColorPair('txt-themeMenuText',      'cp-themeMenuText');
      bindColorPair('txt-themeMenuActiveBg',  'cp-themeMenuActiveBg');
      bindColorPair('txt-themeMenuActiveText','cp-themeMenuActiveText');

      // â”€â”€ Logo upload (fills logoPath-input on success) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const logoUploadBtn    = document.getElementById('logo-upload-btn');
      const logoUploadStatus = document.getElementById('logo-upload-status');
      if (logoUploadBtn) {
        logoUploadBtn.addEventListener('click', async () => {
          const file = document.getElementById('logo-file').files[0];
          const pass = document.getElementById('logo-pass').value;
          if (!file) { logoUploadStatus.textContent = i18nJs.selectFile; return; }
          if (!pass) { logoUploadStatus.textContent = i18nJs.enterPass; return; }
          logoUploadStatus.textContent = i18nJs.uploading;
          const fd = new FormData();
          fd.append('image', file);
          fd.append('password', pass);
          const r = await fetch('/admin/upload-image', { method: 'POST', body: fd });
          const j = await r.json();
          if (j.ok) {
            document.getElementById('logoPath-input').value = j.url;
            logoUploadStatus.innerHTML = i18nJs.logoOk + '<code>' + j.url + '</code>';
          } else {
            logoUploadStatus.textContent = j.error || i18nJs.uploadErr;
          }
        });
      }

      // â”€â”€ Favicon delete (prompt for password inline) â”€â”€
      function deleteFavicon(btn) {
        const pw = prompt('Root admin ÎºÏ‰Î´Î¹ÎºÏŒÏ‚ Î³Î¹Î± Î´Î¹Î±Î³ÏÎ±Ï†Î® favicon:');
        if (!pw) return;
        const form = btn.closest('form');
        form.querySelector('#fav-del-pw').value = pw;
        form.submit();
      }
    </script>
  </body>
</html>
