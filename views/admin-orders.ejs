<!DOCTYPE html>
<html lang="<%= lang %>">
  <head>
    <meta charset="UTF-8" />
    <title><%= t('orders.headerTitle') %> – <%= config.storeName %></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/styles.css" />
    <style>
      :root {
        --primary-color: <%= config.primaryColor %>;
        --accent-color: <%= config.accentColor %>;
        --font-family: <%= config.fontFamily %>;
        --menu-bg: <%= (config.theme && config.theme.menuBg) || '#111' %>;
        --menu-text: <%= (config.theme && config.theme.menuText) || '#fff' %>;
        --menu-active-bg: <%= (config.theme && config.theme.menuActiveBg) || '#f06292' %>;
        --menu-active-text: <%= (config.theme && config.theme.menuActiveText) || '#fff' %>;
        --button-radius: <%= (config.theme && config.theme.buttonRadius) || '4px' %>;
      }

      .orders-table { width: 100%; border-collapse: collapse; font-size: 0.88rem; }
      .orders-table th, .orders-table td {
        text-align: left; padding: 9px 12px;
        border-bottom: 1px solid #e0e0e0;
      }
      .orders-table th { background: #f5f5f5; font-weight: 600; white-space: nowrap; }
      .orders-table tr:hover td { background: #fafafa; }

      .status-badge {
        display: inline-block; padding: 2px 8px; border-radius: 20px;
        font-size: 0.78rem; font-weight: 600; white-space: nowrap;
      }
      .status-PENDING_COD    { background: #fff3cd; color: #7a5c00; }
      .status-PENDING_STRIPE { background: #cce5ff; color: #004085; }
      .status-PAID           { background: #d4edda; color: #155724; }
      .status-CANCELLED      { background: #f8d7da; color: #721c24; }

      .helper { font-size: 0.82rem; color: #666; margin: 0 0 14px; }
      .empty-msg { color: #888; font-style: italic; padding: 20px 0; }

      .fullops-banner {
        background: #fff3cd; border: 1px solid #ffc107;
        border-radius: 6px; padding: 14px 18px; margin-bottom: 20px;
        font-size: 0.95rem; line-height: 1.5; color: #5a4200;
      }
    </style>
  </head>
  <body>
    <header>
      <h1><%= t('orders.headerTitle') %></h1>
      <p class="subtitle">
        <%= t('orders.store') %>: <strong><%= tenant.id %></strong>
        &nbsp;·&nbsp;
        <%= t('orders.package') %>: <strong><%= tenant.supportTier %></strong>
        &nbsp;·&nbsp;
        <a href="/admin" style="font-size:0.85rem"><%= t('orders.settingsLink') %></a>
        &nbsp;|&nbsp;
        <a href="/admin/orders" style="font-size:0.85rem"><%= t('orders.ordersLink') %></a>
        &nbsp;|&nbsp;
        <a href="/" style="font-size:0.85rem"><%= t('orders.storefrontLink') %></a>
      </p>
    </header>

    <main class="admin-layout">

      <% if (tenant.supportTier === 'FULL_OPS_START') { %>
      <div class="fullops-banner">
        <strong><%= t('orders.fullOpsBanner') %></strong><br>
        <%= t('orders.fullOpsText') %>
      </div>
      <% } %>

      <nav class="admin-tabs">
        <a href="/admin"><%= t('orders.tabTheme') %></a>
        <a href="/admin#tab-categories"><%= t('admin.tabCategories') %></a>
        <a href="/admin#tab-products"><%= t('admin.tabProducts') %></a>
        <a href="/admin#tab-upload"><%= t('admin.tabImages') %></a>
        <a href="/admin/orders" class="active"><%= t('orders.tabOrders') %></a>
      </nav>

      <section class="admin-block">
        <h2><%= t('orders.title') %></h2>
        <p class="helper">
          <%= t('orders.helperPrefix') %> <%= orders.length %> <%= t('orders.helperSuffix') %>
        </p>

        <% if (orders.length === 0) { %>
          <p class="empty-msg"><%= t('orders.empty') %></p>
        <% } else { %>
        <div style="overflow-x:auto;">
          <table class="orders-table">
            <thead>
              <tr>
                <th><%= t('orders.colDate') %></th>
                <th><%= t('orders.colId') %></th>
                <th><%= t('orders.colProduct') %></th>
                <th><%= t('orders.colTotal') %></th>
                <th><%= t('orders.colShipping') %></th>
                <th><%= t('orders.colPayment') %></th>
                <th><%= t('orders.colStatus') %></th>
              </tr>
            </thead>
            <tbody>
              <% orders.forEach(function(order) { %>
                <tr>
                  <td style="white-space:nowrap;">
                    <% const d = new Date(order.createdAt); %>
                    <%= d.toLocaleDateString(lang) %>
                    <br><small style="color:#888;"><%= d.toLocaleTimeString(lang, {hour:'2-digit',minute:'2-digit'}) %></small>
                  </td>
                  <td><code style="font-size:0.78rem;"><%= order.id %></code></td>
                  <td><%= order.productName || '–' %></td>
                  <td><strong><%= typeof order.total === 'number' ? order.total.toFixed(2) : '–' %></strong></td>
                  <td><%= order.shippingMethodLabel || order.shippingMethodId || '–' %></td>
                  <td><%= order.paymentMethodLabel  || order.paymentMethodId  || '–' %></td>
                  <td>
                    <%
                      const statusLabels = {
                        PENDING_COD:    t('orders.statusPendingCod'),
                        PENDING_STRIPE: t('orders.statusPendingStripe'),
                        PAID:           t('orders.statusPaid'),
                        CANCELLED:      t('orders.statusCancelled')
                      };
                    %>
                    <span class="status-badge status-<%= order.paymentStatus || 'PENDING_COD' %>">
                      <%= statusLabels[order.paymentStatus] || order.paymentStatus || '–' %>
                    </span>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
        <% } %>
      </section>

    </main>
  </body>
</html>
