<!DOCTYPE html>
<html lang="<%= lang %>">
  <head>
    <meta charset="UTF-8" />
    <title><%= t('content.pageTitle') %> ‚Äì <%= config.storeName %></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="/favicon.ico" />
    <link rel="stylesheet" href="/styles.css" />
    <style>
      :root {
        --primary-color: <%= config.primaryColor %>;
        --accent-color:  <%= config.accentColor %>;
        --font-family:   <%= config.fontFamily %>;
        --button-radius: <%= (config.theme && config.theme.buttonRadius) || '4px' %>;
      }
      body { background: #f8fafc; }

      .content-hero {
        background: linear-gradient(135deg, var(--primary-color, #4f46e5) 0%, var(--accent-color, #7c3aed) 100%);
        color: #fff; padding: 36px 24px; text-align: center;
      }
      .content-hero h1 { margin: 0 0 8px; font-size: 1.6rem; }
      .content-hero p  { margin: 0; opacity: .85; font-size: .95rem; }
      .content-hero .order-ref {
        display: inline-block; margin-top: 10px;
        background: rgba(255,255,255,.15); border-radius: 20px;
        padding: 3px 14px; font-size: .8rem; font-family: monospace;
      }

      .content-wrapper {
        max-width: 820px; margin: 0 auto; padding: 28px 16px 60px;
      }

      .content-card {
        background: #fff; border-radius: 14px; padding: 28px;
        margin-bottom: 24px; box-shadow: 0 2px 12px rgba(0,0,0,.07);
      }
      .content-card h2 {
        margin: 0 0 6px; font-size: 1.1rem; display: flex; align-items: center; gap: 8px;
      }
      .content-card .product-name {
        font-size: .85rem; color: #6b7280; margin: 0 0 20px;
      }

      /* ‚îÄ‚îÄ Manual / PDF ‚îÄ‚îÄ */
      .manual-block { margin-bottom: 22px; }
      .manual-block p { font-size: .88rem; color: #374151; margin: 0 0 12px; }
      .manual-thumb {
        display: flex; align-items: center; gap: 14px;
        background: #f9fafb; border: 1px solid #e5e7eb;
        border-radius: 8px; padding: 14px 18px;
      }
      .manual-thumb .pdf-icon {
        font-size: 2.2rem; flex-shrink: 0;
      }
      .manual-thumb .pdf-info { flex: 1; }
      .manual-thumb .pdf-info strong { display: block; font-size: .9rem; }
      .manual-thumb .pdf-info span { font-size: .78rem; color: #6b7280; }
      .btn-download {
        display: inline-flex; align-items: center; gap: 6px;
        background: var(--primary-color, #4f46e5); color: #fff;
        border-radius: var(--button-radius, 4px); padding: 9px 18px;
        text-decoration: none; font-size: .88rem; font-weight: 600;
        transition: opacity .15s;
      }
      .btn-download:hover { opacity: .85; }

      /* ‚îÄ‚îÄ Video ‚îÄ‚îÄ */
      .video-block { margin-top: 22px; }
      .video-block p { font-size: .88rem; color: #374151; margin: 0 0 12px; }
      .video-wrapper {
        position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;
        border-radius: 10px; background: #000;
      }
      .video-wrapper iframe, .video-wrapper video {
        position: absolute; inset: 0; width: 100%; height: 100%; border: 0;
        border-radius: 10px;
      }

      /* ‚îÄ‚îÄ Content description ‚îÄ‚îÄ */
      .content-desc {
        background: #f0fdf4; border-left: 4px solid #22c55e;
        border-radius: 0 8px 8px 0; padding: 12px 16px;
        font-size: .88rem; color: #15803d; margin-bottom: 20px;
      }

      /* ‚îÄ‚îÄ No digital content ‚îÄ‚îÄ */
      .no-content {
        text-align: center; padding: 48px 24px; color: #6b7280;
      }
      .no-content h2 { font-size: 1.1rem; }

      .back-link {
        display: inline-block; margin-top: 10px;
        color: var(--primary-color, #4f46e5); font-size: .86rem; text-decoration: none;
      }
      .back-link:hover { text-decoration: underline; }

      /* ‚îÄ‚îÄ Security note ‚îÄ‚îÄ */
      .security-note {
        font-size: .75rem; color: #9ca3af; text-align: center;
        margin-top: 32px; padding-top: 16px; border-top: 1px solid #e5e7eb;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="logo-title">
        <% if (config.logoPath) { %>
          <img src="<%= config.logoPath %>" alt="<%= config.storeName %>" class="logo" />
        <% } %>
        <a href="/" style="text-decoration:none;color:inherit;"><h1><%= config.storeName %></h1></a>
      </div>
    </header>

    <div class="content-hero">
      <h1>üîê <%= t('content.pageTitle') %></h1>
      <p><%= t('content.heroSub') %></p>
      <span class="order-ref"><%= t('content.orderRef') %>: #<%= order.id %></span>
    </div>

    <div class="content-wrapper">

      <% if (!digitalItems || digitalItems.length === 0) { %>
        <div class="content-card no-content">
          <h2><%= t('content.noDigitalContent') %></h2>
          <p><%= t('content.noDigitalContentSub') %></p>
          <a href="/" class="back-link">‚Üê <%= t('checkout.backToStore') %></a>
        </div>

      <% } else { %>
        <% digitalItems.forEach(function(product) { %>
          <div class="content-card">
            <h2>üì¶ <%= product.name %></h2>
            <p class="product-name">
              <%= t('content.purchasedProduct') %>
              <% if (product.sku) { %> ¬∑ SKU: <%= product.sku %><% } %>
            </p>

            <% if (product.contentDescription) { %>
              <div class="content-desc">
                <strong><%= t('content.whatsIncluded') %>:</strong> <%= product.contentDescription %>
              </div>
            <% } %>

            <%# ‚îÄ‚îÄ Manual / PDF ‚îÄ‚îÄ %>
            <% if (product.manualUrl) { %>
              <div class="manual-block">
                <p><strong>üìÑ <%= t('content.manualTitle') %></strong></p>
                <div class="manual-thumb">
                  <span class="pdf-icon">üìÑ</span>
                  <div class="pdf-info">
                    <strong><%= product.name %> ‚Äì <%= t('content.manual') %></strong>
                    <span><%= t('content.manualSub') %></span>
                  </div>
                  <a href="<%= product.manualUrl %>" class="btn-download" target="_blank" download>
                    ‚¨á <%= t('content.download') %>
                  </a>
                </div>

                <%# Also embed PDF inline if it's a direct PDF URL %>
                <% if (product.manualUrl.toLowerCase().endsWith('.pdf')) { %>
                  <div style="margin-top:16px;border-radius:8px;overflow:hidden;border:1px solid #e5e7eb;">
                    <iframe src="<%= product.manualUrl %>"
                            style="width:100%;height:520px;border:none;"
                            title="<%= product.name %> Manual"></iframe>
                  </div>
                <% } %>
              </div>
            <% } %>

            <%# ‚îÄ‚îÄ Video ‚îÄ‚îÄ %>
            <% if (product.videoUrl) { %>
              <div class="video-block">
                <p><strong>üé¨ <%= t('content.videoTitle') %></strong></p>
                <%
                  const vu = product.videoUrl || '';
                  let embedUrl = '';
                  let isDirectVideo = false;
                  // YouTube
                  const ytMatch = vu.match(/(?:youtu\.be\/|youtube\.com\/(?:watch\?v=|embed\/|shorts\/))([A-Za-z0-9_-]{11})/);
                  if (ytMatch) {
                    embedUrl = 'https://www.youtube.com/embed/' + ytMatch[1] + '?rel=0';
                  } else {
                    // Vimeo
                    const vmMatch = vu.match(/vimeo\.com\/(\d+)/);
                    if (vmMatch) {
                      embedUrl = 'https://player.vimeo.com/video/' + vmMatch[1];
                    } else {
                      // Direct video (mp4/webm/ogg)
                      isDirectVideo = /\.(mp4|webm|ogg)(\?.*)?$/i.test(vu);
                    }
                  }
                %>
                <div class="video-wrapper">
                  <% if (embedUrl) { %>
                    <iframe src="<%= embedUrl %>" allowfullscreen
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture">
                    </iframe>
                  <% } else if (isDirectVideo) { %>
                    <video controls preload="metadata">
                      <source src="<%= vu %>" />
                      Œü browser œÉŒ±œÇ Œ¥ŒµŒΩ œÖœÄŒøœÉœÑŒ∑œÅŒØŒ∂ŒµŒπ video.
                    </video>
                  <% } else { %>
                    <div style="display:flex;align-items:center;justify-content:center;height:200px;background:#1f2937;color:#fff;border-radius:10px;">
                      <a href="<%= vu %>" target="_blank" style="color:#60a5fa;font-size:.95rem;">
                        ‚ñ∂ <%= t('content.watchVideo') %>: <%= vu %>
                      </a>
                    </div>
                  <% } %>
                </div>
              </div>
            <% } %>

          </div>
        <% }) %>

        <a href="/" class="back-link">‚Üê <%= t('checkout.backToStore') %></a>

        <div class="security-note">
          <%= t('content.securityNote') %>
          <br />Order ID: <code><%= order.id %></code>
        </div>
      <% } %>

    </div>
  </body>
</html>
